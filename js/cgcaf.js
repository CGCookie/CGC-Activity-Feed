jQuery(function(e){function a(){e.ajax({type:"POST",url:cgc_scripts.ajaxurl,dataType:"json",data:{action:"cgcaf_initialize"},success:function(e){n(e)}})}function t(){var a=e(".cgcaf-activity-feed"),t=a.find("li.unread").length,i=a.parents("li").find(".activity-feed"),n=e(".unread-feed-count",i);if(0>=t)return n.fadeOut("fast"),i.removeClass("unread-items"),void 0;if(i.addClass("unread-items"),n.length){var c=parseInt(n.text(),10);if(c==t)return;n.wrapInner('<span class="old-count"/>');var f=e("<span />").text(t).css("font-weight","bold").hide();n.append(f),n.find(".old-count").slideUp("fast"),f.slideDown("fast"),setTimeout(function(){f.css("font-weight","normal")},5e3)}else n=e("<b />").addClass("unread-feed-count").html(t).hide(),i.append(n),n.fadeIn("fast")}function i(e){e.fadeOut("fast",function(){e.remove()})}function n(a){a=a?a:!1;var n=e(".cgcaf-activity-feed");if(a&&a.activity.length){if(a.delete_flags&&a.delete_flags.length){for(var c=a.delete_flags.length,f=0;c>=f;f++){var d=e('li[data-key="'+a.delete_flags[f]+'"]',n);i(d)}t()}n.find(".feed-help").length&&n.find(".feed-help").remove();var l=a.max_display?a.max_display:10,s=a.activity.length;n.find("li").length;for(var r=e("<ul/>"),o=0;s>o;o++){var u=e(a.activity[o]).data("key");e('li[data-key="'+u+'"]',n).length||r.append(a.activity[o])}n.prepend(r.html()),n.find("li").length>l&&n.find("li").slice(l).remove(),n.find(".last").removeClass("last").find("li:last").addClass("last"),t()}else if(!n.find("li").length){var v=e("<li />").addClass("feed-help").html("This is your activity feed. When users you follow upload or favorite images, or if you have a new follower, you will be notified here.");n.append(v)}}a(),wp.heartbeat.enqueue("cgcaf-activity","cgcaf_hb_activity",!1),e(document).on("heartbeat-send",function(a,t){var i=e(".cgcaf-activity-feed li:first").data("key");i||(i=""),t.cgcaf_hb_activity={action:"latest",last:i}}),e(document).on("heartbeat-tick.cgcaf-activity",function(e,a){a.hasOwnProperty("cgcaf-data")&&n(a["cgcaf-data"])}),e(".activity-feed").on("click",function(){var a=e(this),t=[];e.each(a.next(".cgcaf-activity-feed").find("li.unread"),function(a,i){var n=e(i),c=n.data("key");c&&(t[t.length]=c,setTimeout(function(){n.removeClass("unread")},2e3))}),t.length&&e.ajax({type:"POST",url:cgc_scripts.ajaxurl,data:{action:"cgcaf_mark_read",keys:t},success:function(){var t=e(".unread-feed-count",a);t.fadeOut("fast")}})})});