jQuery(function(e){function a(){e.ajax({type:"POST",url:cgc_scripts.ajaxurl,dataType:"json",data:{action:"cgcaf_initialize"},success:function(e){i(e)}})}function t(){var a=e(".cgcaf-activity-feed"),t=a.find("li.unread").length,i=a.parents("li").find(".activity-feed"),n=e(".unread-feed-count",i);if(0>=t)return n.fadeOut("fast"),i.removeClass("unread-items"),void 0;if(i.addClass("unread-items"),n.length){var c=parseInt(n.text());if(c==t)return;n.wrapInner('<span class="old-count"/>');var f=e("<span />").text(t).css("font-weight","bold").hide();n.append(f),n.find(".old-count").slideUp("fast"),f.slideDown("fast"),setTimeout(function(){f.css("font-weight","normal")},5e3)}else n=e("<b />").addClass("unread-feed-count").html(t).hide(),i.append(n),n.fadeIn("fast")}function i(a){a=a?a:!1;var i=e(".cgcaf-activity-feed");if(a){if(a.delete_flags&&a.delete_flags.length){for(var n=a.delete_flags.length,c=0;n>=c;c++){var f=e('li[data-key="'+a.delete_flags[c]+'"]',i);f.fadeOut("fast",function(){f.remove()})}t()}if(a.activity.length){i.find(".feed-help").length&&i.find(".feed-help").remove();var d=a.max_display?a.max_display:10,l=a.activity.length,s=i.find("li").length;s+l>d&&(l=d-s);for(var r=e("<ul/>"),o=0;l>o;o++){var u=e(a.activity[o]).data("key");e('li[data-key="'+u+'"]',i).length||r.append(a.activity[o])}i.append(r.html()),i.find(".last").removeClass("last").find("li:last").addClass("last"),t()}else if(!i.find("li").length){var v=e("<li />").addClass("feed-help").html("This is your activity feed. When users you follow upload or favorite images, or if you have a new follower, you will be notified here.");i.append(v)}}}a(),wp.heartbeat.enqueue("cgcaf-activity","cgcaf_hb_activity",!1),e(document).on("heartbeat-send",function(a,t){var i=e(".cgcaf-activity-feed li:first").data("key");i||(i=""),t.cgcaf_hb_activity={action:"latest",last:i}}),e(document).on("heartbeat-tick.cgcaf-activity",function(e,a){a.hasOwnProperty("cgcaf-data")&&i(a["cgcaf-data"])}),e(".activity-feed").on("click",function(){var a=e(this),t=[];e.each(a.next(".cgcaf-activity-feed").find("li.unread"),function(a,i){var n=e(i),c=n.data("key");c&&(t[t.length]=c,setTimeout(function(){n.removeClass("unread")},2e3))}),t.length&&e.ajax({type:"POST",url:cgc_scripts.ajaxurl,data:{action:"cgcaf_mark_read",keys:t},success:function(){var t=e(".unread-feed-count",a);t.fadeOut("fast")}})})});